<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous">
    </script>

</head>
<body>

    <div class="container">
        <div class="row">
            <ul class="nav nav-pills">
              <li role="presentation" ><a href="/group6coffee/index">Home</a></li>
              <li role="presentation"><a href="/group6coffee/productlist">{{ user_name }}</a></li>
                <li role="presentation" class="active"><a href="/group6coffee/orderlist">Order list</a></li>
              <li role="presentation"><a href="/group6coffee/logout">Logout</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="jumbotron">
                <h2 style="text-align: center">Your order</h2>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <div class="panel panel-default" style="margin-top: 50px">

              <div class="panel-body">
                <table class="table table-striped">
                    <tr>
                        <th>
                            <p>Product Name</p>
                        </th>
                        <th>
                            <p>Price</p>
                        </th>
                        <th>
                            <p>Quantity</p>
                        </th>
                        <th>
                            <p>Sub Total</p>
                        </th>
                        <th>
                            <p>Order Time</p>
                        </th>
                        <th>
                            <p>Order Status</p>
                        </th>
                        <th>
                            <p>Order No</p>
                        </th>
                    </tr>

                    {% for item in orders %}
                        <tr>
                            <td>
                                <p>{{ item.product_name }}</p>
                            </td>

                            <td>
                                <p>{{ item.product_price }}</p>
                            </td>

                            <td>
                                <p>{{ item.order_number }}</p>
                            </td>

                            <td>
                                <p>{{ item.order_sub_total }}</p>
                            </td>

                            <td>
                                <p>{{ item.created_at }}</p>
                            </td>

                            <td>
                                <p>{{ item.order_status }}</p>
                            </td>
                            <td>
                                <p>{{ item.order_item_id }}</p>
                            </td>

                            <td>
                                <div>
                                    {% if item.order_status == 'Preparing' %}
                                        <form action="" method="POST">
                                        {% csrf_token %}
                                            <input class="hidden user_name" value="{{ user_name }}">
                                         <input class="hidden id" value="{{ item.order_item_id }}">
                                        <button class="btn btn-primary" id='submit' type="submit">Cancel</button>
                                        </form>
                                    {% endif %}

                                </div>
                            </td>

                        </tr>
                    {% endfor %}
                </table>
              </div>
            </div>
            </div>
        </div>
    </div>




    <div class="container">
        <div class="row">
            <div style="margin-top: 50px">
                <p style="text-align: center">copyright@group6coffee</p>
            </div>
        </div>
    </div>

    <script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script>
    <script>
         $(function () {
            let dict = {};
            let id;
            let user_name;

            $("#submit").click(function () {
                id = $(this).parent().children('input.id').val();
                user_name = $(this).parent().children('input.user_name').val();

                dict['user_name'] = user_name
                dict['order_item_id'] = id

                fetch('cancelorder',{
                    method: "POST",
                    body: JSON.stringify(dict)
                }).then(function (res) {
                    console.log(res.text());
                    if (res.ok){
                        $('#showpayment').text('Successful');
                        console.log("yes")
                    } else {
                        console.log("no")
                    }
                })
            })

        })
    </script>

</body>
</html>